# .github/workflows/deploy.yml
name: Deploy Hugo Site from io folder to GitHub Pages (gh-pages branch)

# å½“ main åˆ†æ”¯æœ‰æ–°çš„ push æ—¶è§¦å‘æ­¤å·¥ä½œæµ
on:
  push:
    branches:
      - main # ğŸ“¢ æ‚¨çš„ Hugo æºæ–‡ä»¶æ‰€åœ¨çš„åˆ†æ”¯ï¼Œé€šå¸¸æ˜¯ main

# å®šä¹‰ä¸€ä¸ªåä¸º "deploy" çš„ä½œä¸š
jobs:
  deploy:
    # ä½œä¸šè¿è¡Œåœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä¸Š
    runs-on: ubuntu-latest

    # æƒé™é…ç½®ï¼šå…è®¸ GITHUB_TOKEN æœ‰å†™å…¥å†…å®¹å’Œ pages çš„æƒé™
    # è¿™å¯¹äº peaceiris/actions-gh-pages éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯æ˜¯å¿…éœ€çš„
    permissions:
      contents: write # å…è®¸å†™å…¥åˆ° gh-pages åˆ†æ”¯
      pages: write    # å…è®¸ç®¡ç† GitHub Pages
      id-token: write # é’ˆå¯¹ OIDCï¼Œç°ä»£ GitHub Pages éƒ¨ç½²é€šå¸¸éœ€è¦

    # ä½œä¸šæ­¥éª¤
    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»“åº“ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4 # ä½¿ç”¨ actions/checkout@v4 æ£€å‡ºä»£ç 
        with:
          submodules: true # ğŸ“¢ å¦‚æœæ‚¨çš„ Hugo ä¸»é¢˜æ˜¯ Git å­æ¨¡å—ï¼Œè¯·åŠ¡å¿…ä¿ç•™æ­¤è¡Œï¼Œå¦åˆ™å¯ä»¥åˆ é™¤
          fetch-depth: 0   # è·å–å®Œæ•´çš„ Git å†å²ï¼Œä»¥ä¾¿ Hugo èƒ½å¤Ÿè®¿é—®æ‰€æœ‰ Git ä¿¡æ¯ï¼ˆå¦‚ commit æ—¥æœŸï¼‰

      # æ­¥éª¤ 2: è®¾ç½® Hugo ç¯å¢ƒ
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3 # ä½¿ç”¨ peaceiris/actions-hugo@v3 æ¥è®¾ç½® Hugo
        with:
          hugo-version: 'latest' # ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Hugoï¼Œæ‚¨ä¹Ÿå¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚ '0.120.4'
          extended: true         # ğŸ“¢ å¦‚æœæ‚¨ä½¿ç”¨äº† Hugo Extended ç‰ˆæœ¬ç‰¹æ€§ï¼ˆå¦‚ Sass/SCSSï¼‰ï¼Œè¯·åŠ¡å¿…ä¿ç•™æ­¤è¡Œï¼Œå¦åˆ™å¯ä»¥åˆ é™¤

      # æ­¥éª¤ 3: æ„å»º Hugo ç«™ç‚¹
      - name: Build Hugo site
        run: | # ä½¿ç”¨å¤šè¡Œå‘½ä»¤
          cd io                   # ğŸ“¢ å…³é”®ï¼šè¿›å…¥æ‚¨çš„ Hugo é¡¹ç›®æ ¹ç›®å½• (io æ–‡ä»¶å¤¹)
          hugo --minify           # è¿è¡Œ Hugo æ„å»ºå‘½ä»¤ï¼Œ--minify ä¼šå‹ç¼© HTML/CSS/JS
        # Hugo å°†æ ¹æ® `io/config.toml` ä¸­çš„ `publishDir = "public"`
        # åœ¨ `io/` ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª `public` æ–‡ä»¶å¤¹
        # å› æ­¤ï¼Œç›¸å¯¹äºä»“åº“æ ¹ç›®å½•ï¼Œç”Ÿæˆçš„é™æ€æ–‡ä»¶åœ¨ `./io/public`

      # æ­¥éª¤ 4: éƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3 # ä½¿ç”¨ peaceiris/actions-gh-pages@v3 éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # GitHub æä¾›çš„ tokenï¼Œç”¨äºè®¤è¯
          publish_dir: ./io/public                   # *** å…³é”®ï¼šæŒ‡å®šç”Ÿæˆçš„é™æ€æ–‡ä»¶ç›®å½•ï¼Œç›¸å¯¹äºä»“åº“æ ¹ç›®å½• ***
          publish_branch: gh-pages                   # ç›®æ ‡éƒ¨ç½²åˆ†æ”¯ï¼Œè¿™é‡Œå°±æ˜¯ gh-pages
          # cname: your-custom-domain.com            # ğŸ“¢ å¦‚æœæ‚¨ä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼Œè¯·å–æ¶ˆæ³¨é‡Šå¹¶å°†å…¶æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå (ä¾‹å¦‚ myblog.com)
